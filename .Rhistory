geom_jitter(data = A3,aes(x=진료과목코드,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
stat_smooth(method = "lm") +
ylim(0,10000)
ggplot()+
geom_jitter(data = A3,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
stat_smooth(method = "lm") +
ylim(0,10000)
ggplot()+
geom_point(data = A3,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
stat_smooth(method = "lm") +
ylim(0,10000)
ggplot()+
geom_point(data = A3,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
stat_smooth(method = "lm")
ggplot()+
geom_point(data = A3,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_smooth(method = "lm")
ggplot()+
geom_point(data = A3,aes(x=입내원일수,y=심결본인부담금))
sum(okfine$coefficients)
ggplot()+
geom_point(data = A3,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_abline(intercept=128.164,slope= 8.718,
colour="green",linetype=2)
ggplot()+
geom_point(data = A3,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_abline(intercept=8.718,slope=128.164 ,
colour="green",linetype=2)
ok2 <- lm(심결본인부담금~연령대코드,data=train)
summary(ok2)
ok2
ggplot()+
geom_point(data = A3,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_abline(intercept=1523.9,slope=365.6 ,
colour="green",linetype=2)
ggplot()+
geom_point(data = train,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_abline(intercept=1523.9,slope=365.6 ,
colour="green",linetype=2)
ok2 <- lm(심결본인부담금~연령대코드,data=A3)
ok2
ggplot()+
geom_point(data = train,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_abline(intercept=1523.9,slope=454,
colour="green",linetype=2)
ggplot()+
geom_point(data = train,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_abline(intercept=1523.9,slope=1000,
colour="green",linetype=2)
ggplot()+
geom_point(data = train,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_abline(intercept=1523.9,slope=10000,
colour="green",linetype=2)
okfine
ggplot()+
geom_point(data = train,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_abline(intercept=-20701,slope=15141,
colour="green",linetype=2)
ggplot()+
geom_point(data = train,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_abline(intercept=-20701,slope=15141,
colour="green",linetype=2,size=2)
ggplot()+
geom_point(data = train,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_abline(intercept=-20701,slope=15141,
colour="green",linetype=2,size=1.5)
ggplot()+
geom_point(data = train,aes(x=입내원일수,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_abline(intercept=-20701,slope=15141,
colour="green",linetype=2,size=1)
okfine
15141
ggplot()+
geom_point(data = train,aes(x=진료과목코드,y=심결본인부담금)) +
scale_x_discrete(limits = c(4,11,23,1,14)) +
geom_abline(intercept=-20701,slope=15141,
colour="green",linetype=2,size=1)
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수,data = train)
summary(okfine)
pred <- predict(okfine,newdata=test)
cor1 <- cor(pred,test$심결본인부담금,use="pairwise.complete.obs")
cor1 <- cor(pred,test$심결본인부담금,use="pairwise.complete.obs")
pred <- predict(okfine,newdata=test)
cor1 <- cor(pred,test$심결본인부담금,use="pairwise.complete.obs")
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수,data = train)
summary(okfine)
train1 <- train[train$진료과목코드==14|
train$진료진료과목코드==23,]
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수,data = train1)
str(train23)
str(train1)
View(train1)
View(train)
train1 <- train[train$진료과목코드==14|
train$진료진료과목코드==23,]
table(train$진료과목코드)
train1 <- train[train$진료과목코드==14,]
train1 <- train[train$진료과목코드==14|
train$진료진료과목코드==23,]
train1 <- train[train$진료과목코드==14|
train$진료과목코드==23,]
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수,data = train1)
summary(okfine)
pred <- predict(okfine,newdata=test)
test1 <- test[test$진료과목코드==14|
test$진료과목코드==23,]
pred <- predict(okfine,newdata=test1)
cor1 <- cor(pred,test$심결본인부담금,use="pairwise.complete.obs")
cor(pred,test$심결본인부담금,use="pairwise.complete.obs")
cor(pred,test1$심결본인부담금,use="pairwise.complete.obs")
relweights <- function(fit,...){
R <- cor(fit$model)
nvar <- ncol(R)
rxx <- R[2:nvar, 2:nvar]
rxy <- R[2:nvar, 1]
svd <- eigen(rxx)
evec <- svd$vectors
ev <- svd$values
delta <- diag(sqrt(ev))
lambda <- evec %*% delta %*% t(evec)
lambdasq <- lambda ^ 2
beta <- solve(lambda) %*% rxy
rsquare <- colSums(beta ^ 2)
rawwgt <- lambdasq %*% beta ^ 2
import <- (rawwgt / rsquare) * 100
import <- as.data.frame(import)
row.names(import) <- names(fit$model[2:nvar])
names(import) <- "Weights"
import <- import[order(import),1, drop=FALSE]
dotchart(import$Weights, labels=row.names(import),
xlab="% of R-Square", pch=19,
main="Relative Importance of Predictor Variables",
sub=paste("Total R-Square=", round(rsquare, digits=3)),
...)
return(import)
}
relweights(okfine)
relweights(okfine)
okfine <- lm(연령대코드+진료과목코드+
심결가산율+입내원일수~심결본인부담금,data = train1)
okfine$model
plot(okfine)
attach(train)
plot(심결본인부담금~연령대코드)
abline
abline(okfine)
abline(okfine$model$연령대코드)
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)+
geom_smooth(method = "lm")
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)+
geom_smooth(aes(group=심결본인부담금))
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)+
geom_smooth(aes(x=연령대코드,y=심결본인부담금))
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)+
coord_cartesian(ylim = c(0,10000))
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)+
coord_cartesian(ylim = c(0,10000)) +
geom_smooth(aes(group=심결본인부담금))
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)+
geom_smooth(aes(group=심결본인부담금))
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)+
coord_cartesian(ylim = c(0,10000))
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)+
coord_cartesian(ylim = c(0,10000)) +
geom_smooth(aes(x=연령대코드,y=심결본인부담금))
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)+
coord_cartesian(ylim = c(0,50000)) +
geom_smooth(aes(x=연령대코드,y=심결본인부담금))
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)+
coord_cartesian(ylim = c(0,10000)) +
geom_smooth(aes(x=연령대코드,y=심결본인부담금))
ggplot()+
geom_point(aes(x=연령대코드,y=심결본인부담금),data = train)+
coord_cartesian(ylim = c(0,100000)) +
geom_smooth(aes(x=연령대코드,y=심결본인부담금))
geom_point(aes(x=진료과목코드,y=심결본인부담금),data = train)+
ggplot()+
geom_point(aes(x=진료과목코드,y=심결본인부담금),data = train)+
coord_cartesian(ylim = c(0,100000)) +
geom_smooth(aes(x=진료과목코드,y=심결본인부담금))
ggplot()+
geom_point(aes(x=진료과목코드,y=심결본인부담금),data = train)+
coord_cartesian(ylim = c(0,100000)) +
geom_smooth(aes(x=진료과목코드,y=심결본인부담금))
ggplot()+
geom_point(aes(x=진료과목코드,y=심결본인부담금),data = train)
ggplot()+
geom_point(aes(x=진료과목코드,y=심결본인부담금),data = train) +
geom_smooth(aes(x=진료과목코드,y=심결본인부담금))
geom_point(aes(x=심결가산ㅇ,y=심결본인부담금),data = train)+
12
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train)+
coord_cartesian(ylim = c(0,100000)) +
geom_smooth(aes(x=심결가산율,y=심결본인부담금))
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train)
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
geom_smooth(aes(x=심결가산율,y=심결본인부담금),data = train)
str(train)
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train)
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
geom_smooth(aes(x=심결가산율,y=심결본인부담금))
okfine
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
geom_abline(intercept = -30000, slope = 1124.16 ,
col = "blue", lty = 2,size=1)
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수,data = train)
okfine
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
geom_abline(intercept = -20776, slope = 499.56 ,
col = "blue", lty = 2,size=1)
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
coord_cartesian(ylim = c(0,100000)) +
geom_abline(intercept = -20776, slope = 499.56 ,
col = "blue",lty = 2 ,size=1)
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
coord_cartesian(ylim = c(0,100000),
xlim = c(10,35)) +
geom_abline(intercept = -20776, slope = 499.56 ,
col = "blue",lty = 2 ,size=1)
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
coord_cartesian(ylim = c(0,100000),
xlim = c(10,35)) +
geom_abline(aes(x=연령대코드,y=심결본인부담금))
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
coord_cartesian(ylim = c(0,100000),
xlim = c(10,35)) +
geom_abline(aes(x=심결가산율,y=심결본인부담금))
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
coord_cartesian(ylim = c(0,100000),
xlim = c(10,35)) +
geom_smooth(aes(x=심결가산율,y=심결본인부담금))
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
coord_cartesian(ylim = c(0,100000),
xlim = c(10,35)) +
geom_abline(intercept = -20776, slope = 15000 ,
col = "blue",lty = 2 ,size=1)
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
coord_cartesian(ylim = c(0,100000),
xlim = c(10,35)) +
geom_abline(intercept = 0, slope =  499.56,
col = "blue",lty = 2 ,size=1)
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
coord_cartesian(ylim = c(0,100000),
xlim = c(10,35)) +
geom_abline(intercept = 5000, slope =  499.56,
col = "blue",lty = 2 ,size=1)
ggplot()+
geom_point(aes(x=심결가산율,y=심결본인부담금),data = train) +
coord_cartesian(ylim = c(0,100000),
xlim = c(10,35)) +
geom_abline(intercept = 3000, slope =  499.56,
col = "blue",lty = 2 ,size=1)
ggplot()+
geom_jitter(aes(x=심결가산율,y=심결본인부담금),data = train) +
coord_cartesian(ylim = c(0,100000),
xlim = c(10,35)) +
geom_abline(intercept = 3000, slope =  499.56,
col = "blue",lty = 2 ,size=1)
ggplot()+
geom_jitter(aes(x=심결가산율,y=심결본인부담금),data = train) +
coord_cartesian(ylim = c(0,75000),
xlim = c(10,35)) +
geom_abline(intercept = 3000, slope =  499.56,
col = "blue",lty = 2 ,size=1)
library(dplyr)
library(plyr)
library(ggplot2)
Z2 <-A3 %>%
group_by(부상병코드) %>%
summarise(value = mean(심결본인부담금))
View(Z2)
View(A3)
str(A3)
Z2 <- A3 %>%
group_by(부상병코드) %>%
summarise(value = mean(심결본인부담금))
Z2 <- ddply(A3,~부상병코드,summarise,value = mean(심결본인부담금))
View(Z2)
Z3 <- data.frame(table(A3$부상병코드))
View(Z2)
View(Z2)
View(Z3)
Z3 <- merge(Z2,Z3,by.x = "부상병코드",by.y = "Var1" )
View(Z3)
A3 <- transform(A2,
main = ifelse(A2$주상병코드 == "B01"|
A2$주상병코드 == "B018"|
A2$주상병코드 == "B019",1,NA),
sub = ifelse(A2$부상병코드 == "L309",1,
ifelse(A2$부상병코드 == "R509",2,
ifelse(A2$부상병코드 == "L010",3,
ifelse(A2$부상병코드 == "K297",4,
ifelse(A2$부상병코드 == "L239",5,
ifelse(A2$부상병코드 == "J068",6,
ifelse(A2$부상병코드 == "J069",7,0)))))
)
))
A3 <- A3[A3$진료과목코드==1|A3$진료과목코드==4|A3$진료과목코드==11|
A3$진료과목코드==14|A3$진료과목코드==23,]
A3$sub <- factor(A3$sub)
A3$main <- factor(A3$main)
A3$성별코드 <- factor(A3$성별코드)
A3$심결가산율 <- factor(A3$심결가산율)
A3$진료과목코드 <- factor(A3$진료과목코드)
A3$연령대코드 <- (5*(A3$연령대코드-1)+5*(A3$연령대코드)-1)/2
train <- A3[1:13186,] #70%
test <- A3[13187:nrow(A3),] #30%
A3 <- A3 %>%
na.omit()
train <- A3[1:13186,] #70%
test <- A3[13187:nrow(A3),] #30%
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수,data = train)
summary(okfine)
str(A3)
str(train)
summary(okfine)
A3 <- transform(A2,
main = ifelse(A2$주상병코드 == "B01"|
A2$주상병코드 == "B018"|
A2$주상병코드 == "B019",1,NA),
sub = ifelse(A2$부상병코드 == "L309",1,
ifelse(A2$부상병코드 == "R509",2,
ifelse(A2$부상병코드 == "L010",3,
ifelse(A2$부상병코드 == "K297",4,
ifelse(A2$부상병코드 == "L239",5,
ifelse(A2$부상병코드 == "J068",6,
ifelse(A2$부상병코드 == "J069",7,0)))))
)
))
A3$sub <- factor(A3$sub)
A3$main <- factor(A3$main)
A3$성별코드 <- factor(A3$성별코드)
A3$진료과목코드 <- factor(A3$진료과목코드)
A3$연령대코드 <- (5*(A3$연령대코드-1)+5*(A3$연령대코드)-1)/2
A3 <- A3[A3$진료과목코드==1|A3$진료과목코드==4|A3$진료과목코드==11|
A3$진료과목코드==14|A3$진료과목코드==23,]
train <- A3[1:13186,] #70%
test <- A3[13187:nrow(A3),] #30%
A3 <- A3 %>%
na.omit()
train <- A3[1:13186,] #70%
test <- A3[13187:nrow(A3),] #30%
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수,data = train)
summary(okfine)
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수+sub,data = train)
summary(okfine)
A3 <- transform(A2,
main = ifelse(A2$주상병코드 == "B01"|
A2$주상병코드 == "B018"|
A2$주상병코드 == "B019",1,NA),
sub = ifelse(A2$부상병코드 == "L309",1,
ifelse(A2$부상병코드 == "R509",2,
ifelse(A2$부상병코드 == "L010",3,
ifelse(A2$부상병코드 == "K297",4,
ifelse(A2$부상병코드 == "L239",5,
ifelse(A2$부상병코드 == "J068",6,0)))))
)
)
A3 <- A3[A3$진료과목코드==1|A3$진료과목코드==4|A3$진료과목코드==11|
A3$진료과목코드==14|A3$진료과목코드==23,]
A3$sub <- factor(A3$sub)
A3$main <- factor(A3$main)
A3$성별코드 <- factor(A3$성별코드)
A3$진료과목코드 <- factor(A3$진료과목코드)
A3$연령대코드 <- (5*(A3$연령대코드-1)+5*(A3$연령대코드)-1)/2
train <- A3[1:13186,] #70%
test <- A3[13187:nrow(A3),] #30%
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수+sub,data = train)
summary(okfine)
A3 <- transform(A2,
main = ifelse(A2$주상병코드 == "B01"|
A2$주상병코드 == "B018"|
A2$주상병코드 == "B019",1,NA),
sub = ifelse(A2$부상병코드 == "L309",1,
ifelse(A2$부상병코드 == "R509",2,
ifelse(A2$부상병코드 == "L010",3,
ifelse(A2$부상병코드 == "K297",4,
ifelse(A2$부상병코드 == "L239",5,0)))))
)
A3 <- A3[A3$진료과목코드==1|A3$진료과목코드==4|A3$진료과목코드==11|
A3$진료과목코드==14|A3$진료과목코드==23,]
A3 <- A3 %>%
na.omit()
A3$sub <- factor(A3$sub)
A3$main <- factor(A3$main)
A3$성별코드 <- factor(A3$성별코드)
A3$진료과목코드 <- factor(A3$진료과목코드)
A3$연령대코드 <- (5*(A3$연령대코드-1)+5*(A3$연령대코드)-1)/2
train <- A3[1:13186,] #70%
test <- A3[13187:nrow(A3),] #30%
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수+sub,data = train)
summary(okfine)
A3 <- transform(A2,
main = ifelse(A2$주상병코드 == "B01"|
A2$주상병코드 == "B018"|
A2$주상병코드 == "B019",1,NA),
sub = ifelse(A2$부상병코드 == "L309",1,
ifelse(A2$부상병코드 == "R509",2,
ifelse(A2$부상병코드 == "L010",3,
ifelse(A2$부상병코드 == "K297",4,0)))))
A3 <- A3 %>%
na.omit()
A3 <- A3[A3$진료과목코드==1|A3$진료과목코드==4|A3$진료과목코드==11|
A3$진료과목코드==14|A3$진료과목코드==23,]
A3$sub <- factor(A3$sub)
A3$main <- factor(A3$main)
A3$성별코드 <- factor(A3$성별코드)
A3$진료과목코드 <- factor(A3$진료과목코드)
A3$연령대코드 <- (5*(A3$연령대코드-1)+5*(A3$연령대코드)-1)/2
train <- A3[1:13186,] #70%
test <- A3[13187:nrow(A3),] #30%
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수+sub,data = train)
summary(okfine)
A3 <- transform(A2,
main = ifelse(A2$주상병코드 == "B01"|
A2$주상병코드 == "B018"|
A2$주상병코드 == "B019",1,NA),
sub = ifelse(A2$부상병코드 == "L309",1,
ifelse(A2$부상병코드 == "R509",2,
ifelse(A2$부상병코드 == "L010",3,0))))
A3 <- A3 %>%
na.omit()
A3 <- A3[A3$진료과목코드==1|A3$진료과목코드==4|A3$진료과목코드==11|
A3$진료과목코드==14|A3$진료과목코드==23,]
A3$sub <- factor(A3$sub)
A3$main <- factor(A3$main)
A3$성별코드 <- factor(A3$성별코드)
A3$진료과목코드 <- factor(A3$진료과목코드)
A3$연령대코드 <- (5*(A3$연령대코드-1)+5*(A3$연령대코드)-1)/2
train <- A3[1:13186,] #70%
test <- A3[13187:nrow(A3),] #30%
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수+sub,data = train)
summary(okfine)
A3 <- transform(A2,
main = ifelse(A2$주상병코드 == "B01"|
A2$주상병코드 == "B018"|
A2$주상병코드 == "B019",1,NA),
sub = ifelse(A2$부상병코드 == "L309",1,
ifelse(A2$부상병코드 == "R509",2,
ifelse(A2$부상병코드 == "L010",3,
ifelse(A2$부상병코드 == "B029",4,0)))))
A3 <- A3 %>%
na.omit()
A3 <- A3[A3$진료과목코드==1|A3$진료과목코드==4|A3$진료과목코드==11|
A3$진료과목코드==14|A3$진료과목코드==23,]
A3$sub <- factor(A3$sub)
A3$main <- factor(A3$main)
A3$성별코드 <- factor(A3$성별코드)
A3$진료과목코드 <- factor(A3$진료과목코드)
A3$연령대코드 <- (5*(A3$연령대코드-1)+5*(A3$연령대코드)-1)/2
train <- A3[1:13186,] #70%
test <- A3[13187:nrow(A3),] #30%
okfine <- lm(심결본인부담금~연령대코드+진료과목코드+
심결가산율+입내원일수+sub,data = train)
summary(okfine)
